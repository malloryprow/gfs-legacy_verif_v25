
      SUBROUTINE GVALDT(IDATE,JTAU,NDATE)

C$$$  SUBPROGRAM DOCUMENTATION BLOCK
C                .      .    .                                       .
C SUBPROGRAM:   GVALDT       UPDATING DATE/TIME WORD
C   PRGMMR: VLCEK             ORG: W/NP12     DATE: 1999-06-07
C
C ABSTRACT: UPDATES OR BACKDATES A FULLWORD DATE/TIME WORD
C           BY A SPECIFIED NUMBER OF HOURS.
C
C PROGRAM HISTORY LOG:
C   1996-06-10  Y. ZHANG 
C   1998-07-14  C. VLCEK  ACCEPT AND RETURN 4-DIGIT YEAR IN ARG LIST 
C   1999-06-07  C. VLCEK  COMPILE ON IBM RS6000.
C
C USAGE:    CALL GVALDT(IDATE, JTAU, NDATE)
C   INPUT ARGUMENT LIST:
C     IDATE    - 4 INTEGER WORDS DATE/TIME AS FOLLOWS:
C                WORD 1  IS YEAR OF CENTURY  00-99
C                WORD 2  IS MONTH            01-12
C                WORD 3  IS DAY OF MONTH     01-31
C                WORD 4  IS HOUR             00-23
C     JTAU     - INTEGER  NUMBER OF HOURS TO UPDATE (IF POSITIVE)
C                OR BACKDATE (IF NEGATIVE)
C
C   OUTPUT ARGUMENT LIST:
C     NDATE    - NEW DATE/TIME INTEGER WORD
C
C   SUBPROGRAMS CALLED:
C     LIBRARY:
C       W3LIB  - NONE
C
C
C   NOTES:     - NONE
C
C   EXIT STATES:
C     AN ERROR FOUND BY OUT OF RANGE TESTS ON THE GIVEN DATE/TIME
C     INFORMATION WILL BE INDICATED BY RETURNING A BINARY ZERO WORD
C
C   LANGUAGE: IBM FORTRAN 90
C   MACHINE:  IBM RS6000
C
C$$$

      INTEGER  ITABYR(13), LPTB(13), NOLPTB(13), IDATE(4)
      SAVE

      DATA  LPTB  /0000,0744,1440,2184,2904,3648,4368,5112,
     &             5856,6576,7320,8040,8784/
      DATA  NOLPTB/0000,0744,1416,2160,2880,3624,4344,5088,
     &             5832,6552,7296,8016,8760/
C     DATA  ICENTY/1900/

      IYR    = IDATE(1)
      IMONTH = IDATE(2)
      IDAY   = IDATE(3)
      IHOUR  = IDATE(4)

      IF (IYR  .LT.  100) IYR = IYR + 1900
      IF (IYR  .GT. 9999) GO TO 1600
      IF (IMONTH .LE.  0) GO TO 1600
      IF (IMONTH .GT. 12) GO TO 1600
      IF (IDAY   .LE.  0) GO TO 1600
      IF (IDAY   .GT. 31) GO TO 1600
      IF (IHOUR  .LT.  0) GO TO 1600
      IF (IHOUR  .GT. 24) GO TO 1600
      IF (JTAU   .NE.  0) GO TO 100

      NDATE = IYR *1000000 + IMONTH*10000
     &      + IDAY*100     + IHOUR
      RETURN

  100 CONTINUE
C       JAHR  = IYR + ICENTY
        JAHR  = IYR 
        KABUL = 1
        GO TO 900

  200 CONTINUE
        IHRYR  = IHOUR + 24 * (IDAY - 1) + ITABYR(IMONTH)
        IHRYR2 = IHRYR + JTAU

C     ...TO TEST FOR BACKDATED INTO PREVIOUS YEAR...

  300 CONTINUE
        IF (IHRYR2 .LT. 0) GO TO 700

      DO  400  M = 2,13

        IF (IHRYR2 .LT. ITABYR(M)) GO TO 600
  400 CONTINUE

        JAHR   = JAHR   + 1
        IHRYR2 = IHRYR2 - ITABYR(13)
        KABUL  = 2
        GO TO 900

  600 CONTINUE
        MONAT  = M      - 1
        IHRMO  = IHRYR2 - ITABYR(MONAT)
        NODAYS = IHRMO  / 24
        ITAG   = NODAYS + 1
        IUHR   = IHRMO  - NODAYS * 24
        GO TO 1500

C     ALL FINISHED.  RETURN TO CALLING PROGRAM
C     COMES TO 700 IF NEG TOTAL HRS. BACK UP INTO PREVIOUS YEAR

  700 CONTINUE
        JAHR  = JAHR - 1
        KABUL = 3
        GO TO 900

  800 CONTINUE
        IHRYR2 = ITABYR(13) + IHRYR2
        GO TO 300

  900 CONTINUE
        IQUOT  = JAHR / 4
        IRMNDR = JAHR - 4 * IQUOT
        IF (IRMNDR .NE. 0) GO TO 1000

C     WAS MODULO 4, SO MOST LIKELY A LEAP YEAR,

        IQUOT  = JAHR / 100
        IRMNDR = JAHR - 100 * IQUOT
        IF (IRMNDR .NE. 0) GO TO 1200

        IQUOT  = JAHR / 400
        IRMNDR = JAHR - 400 * IQUOT
        IF (IRMNDR .EQ. 0) GO TO 1200

C     COMES TO 1000 IF NOT A LEAP YEAR...

 1000 CONTINUE
      DO  1100  I = 1,13
      ITABYR(I) = NOLPTB(I)
 1100 CONTINUE
      GO TO 1400

 1200 CONTINUE
      DO  1300  I = 1,13
      ITABYR(I) = LPTB(I)
 1300 CONTINUE

 1400 CONTINUE
      GO TO (200,300,800) KABUL

 1500 CONTINUE
C     JAHR  = MOD(JAHR,100)
      NDATE = JAHR *1000000 + MONAT*10000
     &      + ITAG*100      + IUHR
      RETURN

 1600 CONTINUE
      NDATE = 0

      RETURN
      END
